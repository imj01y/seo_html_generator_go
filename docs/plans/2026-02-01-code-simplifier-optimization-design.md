# 全项目代码优化设计方案

**目标:** 使用 code-simplifier 对项目所有代码进行优化，提升代码清晰度、一致性，精简冗余

**范围:** Go 后端 + Python Worker + Vue 前端（约 200 文件）

**方法:** 按技术栈分阶段，按目录分批次，逐层优化

---

## 一、整体架构

```
┌─────────────────────────────────────────────────────────┐
│                    代码优化流程                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  第1阶段: Go 后端 (5批)                                  │
│  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐          │
│  │handler│→│service│→│model│→│repo │→│pkg  │          │
│  └─────┘  └─────┘  └─────┘  └─────┘  └─────┘          │
│                                                         │
│  第2阶段: Python Worker (1批)                           │
│  ┌─────────────────┐                                   │
│  │ content_worker/ │                                   │
│  └─────────────────┘                                   │
│                                                         │
│  第3阶段: Vue 前端 (3批)                                 │
│  ┌─────┐  ┌──────────┐  ┌───────────┐                 │
│  │views│→│components│→│api+stores │                   │
│  └─────┘  └──────────┘  └───────────┘                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 二、批次详细划分

### 第1阶段：Go 后端

| 批次 | 目录 | 预估文件数 | 优化重点 |
|------|------|-----------|----------|
| 1-1 | `api/internal/handler/` | ~36 | Handler 函数简化、请求处理一致性 |
| 1-2 | `api/internal/service/` | ~40 | 业务逻辑简化、减少重复代码 |
| 1-3 | `api/internal/model/` | ~1 | 模型定义规范化 |
| 1-4 | `api/internal/repository/` | ~1 | 数据访问层优化 |
| 1-5 | `api/pkg/` + `api/cmd/` | ~3 | 配置和入口优化 |

### 第2阶段：Python Worker

| 批次 | 目录 | 预估文件数 | 优化重点 |
|------|------|-----------|----------|
| 2-1 | `content_worker/` | ~40 | 爬虫代码简化、异常处理统一 |

### 第3阶段：Vue 前端

| 批次 | 目录 | 预估文件数 | 优化重点 |
|------|------|-----------|----------|
| 3-1 | `web/src/views/` | ~30 | 页面组件简化、模板精简 |
| 3-2 | `web/src/components/` | ~20 | 通用组件优化、Props 规范 |
| 3-3 | `web/src/api/` + `stores/` | ~28 | API 调用统一、状态管理简化 |

**总计: 9 个批次**

---

## 三、优化标准

### 通用优化标准（所有语言）

| 类别 | 检查项 |
|------|--------|
| **清晰度** | 变量/函数命名是否清晰表达意图 |
| | 函数是否过长（>50行考虑拆分） |
| | 嵌套层级是否过深（>3层考虑简化） |
| **一致性** | 同类操作是否使用相同模式 |
| | 错误处理风格是否统一 |
| | 代码格式是否符合语言规范 |
| **精简** | 是否有重复代码可提取 |
| | 是否有未使用的变量/函数/导入 |
| | 是否有过度抽象或不必要的封装 |

### 语言特定标准

| 语言 | 额外检查项 |
|------|-----------|
| **Go** | error 处理是否简洁、是否有不必要的指针、struct 字段顺序 |
| **Python** | 是否符合 PEP8、类型提示是否完整、是否有 Pythonic 写法 |
| **Vue/TS** | 组件是否过大、响应式使用是否正确、类型定义是否完整 |

### 不做的事情

- ❌ 不改变业务逻辑
- ❌ 不添加新功能
- ❌ 不重构架构
- ❌ 不修改 API 接口签名

---

## 四、验证方法

| 阶段 | 验证命令 | 目的 |
|------|----------|------|
| **Go** | `go build ./...` | 确保编译通过 |
| | `go vet ./...` | 静态检查 |
| | `go test ./...` | 运行测试 |
| **Python** | `python -m py_compile *.py` | 语法检查 |
| **Vue** | `npm run build` | 确保构建通过 |
| | `vue-tsc --noEmit` | TypeScript 类型检查 |

---

## 五、执行流程

```
每个批次:
┌────────────────────────────────────────────┐
│ 1. 启动 code-simplifier agent             │
│    └─ 指定目标目录                         │
│                                            │
│ 2. Agent 分析并优化代码                    │
│    └─ 按优化标准修改文件                   │
│                                            │
│ 3. 运行验证命令                            │
│    └─ 确保编译/构建通过                    │
│                                            │
│ 4. 报告优化结果                            │
│    └─ 列出修改的文件和优化点               │
│                                            │
│ 5. 进入下一批次                            │
└────────────────────────────────────────────┘
```

---

## 六、回滚策略

- 每批次完成后可选择 git commit
- 如验证失败，可 `git checkout` 回滚该批次

---

*文档创建时间: 2026-02-01*
