# 池状态监控设计

> **Goal:** 在 PoolConfig.vue 页面新增池运行状态监控区域，展示 Go 对象池和 Python 数据池的实时状态，支持预热、暂停、恢复等操作。

---

## 一、页面布局

在现有 PoolConfig.vue 页面底部新增"池运行状态"区域：

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│ 渲染并发配置                                                                        │
├────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────┐ ┌─────────────────────────────────┐           │
│  │ 并发等级（现有）                 │ │ 资源预估（现有）                 │           │
│  └─────────────────────────────────┘ └─────────────────────────────────┘           │
├────────────────────────────────────────────────────────────────────────────────────┤
│ 池运行状态                            高(500) · 156MB           [配置] [刷新全部]   │
├────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                    │
│  Go 对象池              [预热] [暂停] [恢复]  │  Python 数据池          [刷新数据]  │
│  ─────────────────────────────────────────── │ ───────────────────────────────────│
│  ┌─────────────────────────────────────────┐ │ ┌─────────────────────────────────┐ │
│  │ CSS 类名池                    ● 运行中  │ │ │ 关键词缓存池           ● 运行中 │ │
│  │ ██████████████████████░░░░░░░░ 78%      │ │ │ █████████████████░░░░░░░ 65%    │ │
│  │ 容量: 10k    可用: 7.8k    已用: 2.2k   │ │ │ 容量: 240k   可用: 156k  已用: 84k│ │
│  │ 线程: 4      最后刷新: 14:30:25         │ │ │ 线程: 2      最后刷新: 14:28:10  │ │
│  └─────────────────────────────────────────┘ │ └─────────────────────────────────┘ │
│  ┌─────────────────────────────────────────┐ │ ┌─────────────────────────────────┐ │
│  │ URL 池                        ● 运行中  │ │ │ 图片缓存池             ● 运行中 │ │
│  │ ██████████████░░░░░░░░░░░░░░░░ 56%      │ │ │ ██████████████████████░░ 92%    │ │
│  │ 容量: 10k    可用: 5.6k    已用: 4.4k   │ │ │ 容量: 90k    可用: 82.8k 已用: 7.2k│ │
│  │ 线程: 4      最后刷新: 14:30:25         │ │ │ 线程: 2      最后刷新: 14:28:10  │ │
│  └─────────────────────────────────────────┘ │ └─────────────────────────────────┘ │
│  ┌─────────────────────────────────────────┐ │                                     │
│  │ 关键词表情池                  ⏸ 已暂停  │ │                                     │
│  │ ██████████████████████████████ 100%     │ │                                     │
│  │ 容量: 5k     可用: 5k      已用: 0      │ │                                     │
│  │ 线程: 4      最后刷新: 14:25:00         │ │                                     │
│  └─────────────────────────────────────────┘ │                                     │
│                                              │                                     │
└────────────────────────────────────────────────────────────────────────────────────┘
```

**布局规范：**
- 左右各占 50% 宽度
- 左侧：Go 对象池（cls、url、keyword_emoji）
- 右侧：Python 数据池（关键词缓存、图片缓存）
- 每个池卡片垂直排列，进度条占满卡片宽度

---

## 二、池卡片设计

### 展示字段

| 字段 | 说明 |
|------|------|
| 池名称 | 显示中文名称 |
| 运行状态 | ● 运行中 / ⏸ 已暂停 / ⏹ 已停止 |
| 进度条 | 已用/容量的百分比 |
| 容量 | 池的最大容量 |
| 可用 | 当前可用数量 |
| 已用 | 已使用数量（容量 - 可用） |
| 线程 | 生产填充的线程/协程数量 |
| 最后刷新 | 最后一次刷新时间 |

### 进度条颜色规范

| 利用率 | 颜色 | 说明 |
|--------|------|------|
| < 30% | 绿色 #67C23A | 充足 |
| 30% - 70% | 蓝色 #409EFF | 正常 |
| 70% - 90% | 橙色 #E6A23C | 偏高 |
| > 90% | 红色 #F56C6C | 紧张 |

### 数值格式

- 超过 1000：显示为 `1.2k`
- 超过 1000000：显示为 `1.2M`
- 小于 1000：显示完整数字

### 时间格式

- 当天：`14:30:25`
- 非当天：`01-31 14:30`

---

## 三、操作按钮

### 全局操作

| 按钮 | 功能 | API |
|------|------|-----|
| 刷新全部 | 刷新所有池状态 | GET /api/admin/pool/stats + GET /api/admin/data/stats |

### Go 对象池操作

| 按钮 | 功能 | API |
|------|------|-----|
| 预热 | 预热所有对象池 | POST /api/admin/pool/warmup |
| 暂停 | 暂停所有对象池补充 | POST /api/admin/pool/pause |
| 恢复 | 恢复所有对象池补充 | POST /api/admin/pool/resume |

### Python 数据池操作

| 按钮 | 功能 | API |
|------|------|-----|
| 刷新数据 | 重新加载数据池 | POST /api/admin/data/refresh |

---

## 四、后端待补充字段

### Go 对象池（当前缺失）

| 字段 | 类型 | 说明 |
|------|------|------|
| last_refresh | time | 最后刷新时间 |
| num_workers | int | 当前工作线程数 |

### Python 数据池（当前缺失）

| 字段 | 类型 | 说明 |
|------|------|------|
| name | string | 池名称 |
| size | int | 池容量 |
| available | int | 可用数量 |
| used | int | 已用数量 |
| utilization | float | 利用率 |
| status | string | 运行状态 |
| num_workers | int | 协程数量 |

---

## 五、前端 API 封装

在 `pool-config.ts` 中新增：

```typescript
// 获取 Go 对象池统计
export const getPoolStats = (): Promise<PoolStatsResponse> => {
  return request.get('/admin/pool/stats')
}

// 获取 Python 数据池统计
export const getDataStats = (): Promise<DataStatsResponse> => {
  return request.get('/admin/data/stats')
}

// 预热对象池
export const warmupPool = (percent?: number): Promise<void> => {
  return request.post('/admin/pool/warmup', { percent: percent || 0.5 })
}

// 暂停对象池
export const pausePool = (): Promise<void> => {
  return request.post('/admin/pool/pause')
}

// 恢复对象池
export const resumePool = (): Promise<void> => {
  return request.post('/admin/pool/resume')
}

// 刷新数据池
export const refreshDataPool = (pool?: string): Promise<void> => {
  return request.post('/admin/data/refresh', { pool: pool || 'all' })
}
```

---

## 六、实现任务

### 后端任务

1. Go 对象池：添加 `last_refresh`、`num_workers` 字段
2. Python 数据池：重构统计 API，返回与 Go 对象池一致的结构

### 前端任务

1. 新增 API 封装函数
2. 新增池状态卡片组件
3. 在 PoolConfig.vue 中集成池状态监控区域
4. 实现操作按钮功能
